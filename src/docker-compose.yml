services:
  # ============================================
  # MySQL Databases (Telecom Services)
  # ============================================
  
  catalog-db:
    image: mysql:8.0.40
    container_name: catalog-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword123!
      MYSQL_DATABASE: catalogdb
      MYSQL_USER: cataloguser
      MYSQL_PASSWORD: CatalogPass123!
    ports:
      - "3316:3306"
    volumes:
      - catalog-db-data:/var/lib/mysql
    networks:
      - telecom-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pYourStrongPassword123!"]
      interval: 10s
      timeout: 5s
      retries: 5

  billing-db:
    image: mysql:8.0.40
    container_name: billing-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword123!
      MYSQL_DATABASE: billingdb
      MYSQL_USER: billinguser
      MYSQL_PASSWORD: BillingPass123!
    ports:
      - "3317:3306"
    volumes:
      - billing-db-data:/var/lib/mysql
    networks:
      - telecom-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pYourStrongPassword123!"]
      interval: 10s
      timeout: 5s
      retries: 5

  customer-db:
    image: mysql:8.0.40
    container_name: customer-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword123!
      MYSQL_DATABASE: customerdb
      MYSQL_USER: customeruser
      MYSQL_PASSWORD: CustomerPass123!
    ports:
      - "3318:3306"
    volumes:
      - customer-db-data:/var/lib/mysql
    networks:
      - telecom-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pYourStrongPassword123!"]
      interval: 10s
      timeout: 5s
      retries: 5

  provisioning-db:
    image: mysql:8.0.40
    container_name: provisioning-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword123!
      MYSQL_DATABASE: provisioningdb
      MYSQL_USER: provisioninguser
      MYSQL_PASSWORD: ProvisioningPass123!
    ports:
      - "3319:3306"
    volumes:
      - provisioning-db-data:/var/lib/mysql
    networks:
      - telecom-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pYourStrongPassword123!"]
      interval: 10s
      timeout: 5s
      retries: 5

  identity-db:
    image: mysql:8.0.40
    container_name: identity-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: YourStrongPassword123!
      MYSQL_DATABASE: identitydb
      MYSQL_USER: identityuser
      MYSQL_PASSWORD: IdentityPass123!
    ports:
      - "3320:3306"
    volumes:
      - identity-db-data:/var/lib/mysql
    networks:
      - telecom-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pYourStrongPassword123!"]
      interval: 10s
      timeout: 5s
      retries: 5

  # ============================================
  # API Services
  # ============================================

  identity-api:
    image: ${DOCKER_REGISTRY-}identityapi
    build:
      context: ..
      dockerfile: src/services/identityservice/src/identityservice.api/Dockerfile
    container_name: identity-api
    restart: unless-stopped
    ports:
      - "5001:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=identity-db;Port=3306;Database=identitydb;User=identityuser;Password=IdentityPass123!;
    depends_on:
      identity-db:
        condition: service_healthy
    networks:
      - telecom-network

  catalog-api:
    image: ${DOCKER_REGISTRY-}catalogapi
    build:
      context: ..
      dockerfile: src/services/Catalog/Catalog.API/Dockerfile
    container_name: catalog-api
    restart: unless-stopped
    ports:
      - "5002:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=catalog-db;Port=3306;Database=catalogdb;User=cataloguser;Password=CatalogPass123!;
    depends_on:
      catalog-db:
        condition: service_healthy
    networks:
      - telecom-network

  billing-api:
    image: ${DOCKER_REGISTRY-}billingapi
    build:
      context: ..
      dockerfile: src/services/Billing/Billing.API/Dockerfile
    container_name: billing-api
    restart: unless-stopped
    ports:
      - "5003:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=billing-db;Port=3306;Database=billingdb;User=billinguser;Password=BillingPass123!;
    depends_on:
      billing-db:
        condition: service_healthy
    networks:
      - telecom-network

  customer-api:
    image: ${DOCKER_REGISTRY-}customerapi
    build:
      context: ..
      dockerfile: src/services/Customer/Customer.API/Dockerfile
    container_name: customer-api
    restart: unless-stopped
    ports:
      - "5004:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=customer-db;Port=3306;Database=customerdb;User=customeruser;Password=CustomerPass123!;
    depends_on:
      customer-db:
        condition: service_healthy
    networks:
      - telecom-network

  provisioning-api:
    image: ${DOCKER_REGISTRY-}provisioningapi
    build:
      context: ..
      dockerfile: src/services/Provisioning/Provisioning.API/Dockerfile
    container_name: provisioning-api
    restart: unless-stopped
    ports:
      - "5005:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=provisioning-db;Port=3306;Database=provisioningdb;User=provisioninguser;Password=ProvisioningPass123!;
    depends_on:
      provisioning-db:
        condition: service_healthy
    networks:
      - telecom-network

  gateway-api:
    image: ${DOCKER_REGISTRY-}gatewayapi
    build:
      context: ..
      dockerfile: src/services/Gateway/Gateway.API/Dockerfile
    container_name: gateway-api
    restart: unless-stopped
    ports:
      - "5006:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
    depends_on:
      - catalog-api
      - billing-api
      - customer-api
      - provisioning-api
      - identity-api
    networks:
      - telecom-network

# ============================================
# Networks
# ============================================
networks:
  telecom-network:
    driver: bridge
    name: telecom-network

# ============================================
# Volumes (Persistent Storage)
# ============================================
volumes:
  catalog-db-data:
    name: catalog-db-data
  billing-db-data:
    name: billing-db-data
  customer-db-data:
    name: customer-db-data
  provisioning-db-data:
    name: provisioning-db-data
  identity-db-data:
    name: identity-db-data
